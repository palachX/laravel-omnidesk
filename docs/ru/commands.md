# Artisan-команды

Пакет регистрирует две консольные команды для работы с вебхуками Omnidesk.

## omnidesk:webhooks:create

Создаёт новую запись вебхука в таблице `omni_webhooks`.

```bash
php artisan omnidesk:webhooks:create
```

В интерактивном режиме запрашивает:

1. **Имя вебхука** (опционально) — подсказка из перевода `omnidesk::commands.new_webhook.enter_name`.
2. **Канал (channel)** — подсказка из `omnidesk::commands.new_webhook.enter_channel`.
3. **Создать ли API-ключ** — при подтверждении генерируется случайная строка длиной 30 символов, сохраняется в БД в зашифрованном виде. Ключ нужно сохранить у себя при создании.

После успешного создания команда возвращает код 0. При ошибке выводит сообщение и возвращает код 1.

Использование созданного вебхука:

- По полю `id` (UUID) формируется URL вебхука: в маршруте подставляется этот ID вместо `{omniWebhook}`.
- Этот URL указывается в настройках вебхуков в Omnidesk.
- Поле `api_key` можно использовать для проверки входящих запросов (реализация — в вашем коде).

---

## omnidesk:webhooks:list

Выводит таблицу всех вебхуков из таблицы `omni_webhooks`.

```bash
php artisan omnidesk:webhooks:list
```

Колонки:

| Колонка   | Описание                          |
|-----------|-----------------------------------|
| ID        | UUID вебхука                      |
| Name      | Имя (если задано)                 |
| Channel   | Канал                             |
| Created at| Дата создания                     |

Поле `api_key` в таблицу не выводится. Если вебхуков нет, выводится сообщение `No webhooks found`. Код возврата при успехе: 0.

---

## Локализация сообщений команд

Тексты запросов команды `omnidesk:webhooks:create` берутся из переводов пакета. После публикации переводов:

```bash
php artisan vendor:publish --tag="omnidesk-translations"
```

файлы появятся в `lang/vendor/omnidesk/<locale>/commands.php`. Ключи (для английской локали по умолчанию):

- `new_webhook.starting_message` — сообщение в начале процесса.
- `new_webhook.enter_name` — подсказка для ввода имени.
- `new_webhook.enter_channel` — подсказка для ввода канала.
- `new_webhook.webhook_created` — сообщение об успешном создании (с плейсхолдером `:name`).
- `new_webhook.ask_to_create_api_key` — вопрос о создании API-ключа.

Изменить можно как файлы в `lang/vendor/omnidesk/`, так и добавить свою локаль и скопировать туда нужные ключи.
